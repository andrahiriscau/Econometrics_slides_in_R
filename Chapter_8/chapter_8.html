<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Chapter 8: Heteroskedasticity</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Chapter 8: Heteroskedasticity
]
.subtitle[
## Introductory Econometrics: A Modern Approach
]

---








### Outline

8.1 Consequences of heteroskedasticity for OLS

8.2 Heteroskedasticity-robust inference after OLS estimation    
  - A Heteroskedasticity-Robust LM Statistic

8.3 Testing for heteroskedasticity
  - Breusch-Pagan test for heteroskedasticity
  - The White test for heteroskedasticity
  
8.4 Weighted least squares estimation
  - Heteroskedasticity is known up to a multiplicative constant
  - Unknown heteroskedasticity function (feasible GLS)
  - What if the assumed heteroskedasticity function is wrong?


---
### Introduction

**Homoskedasticity assumption** states that the variance of the unobserved error, `\(u\)`, conditional on the explanatory variables is constant. 

   - In Chapters 4 and 5, we saw that homoskedasticity is needed to justify the usual `t tests`, `F tests`, and `confidence intervals` for OLS estimation of the linear regression model, even with large sample sizes

Homoskedasticity assumption fails whenever the variance of the unobserved factors changes across different segments of the population (called **Heteroskedasticity**)


In this chapter, we discuss the available remedies when heteroskedasticity occurs, and we also show how to test for its presence. We begin by briefly reviewing the consequences of heteroskedasticity for ordinary least squares estimation.

---

## 8.1 Consequences of heteroskedasticity for OLS


Consequences of heteroskedasticity

   - invalidates variance formulas for OLS estimators
  
   - `F tests` and `t tests` are not valid under heteroskedasticity
   
   - OLS is no longer the *best linear unbiased estimator (BLUE)*; there may be more efficient linear estimators
   
   
   
OLS still unbiased and consistent under heteroskedastictiy!

Also, interpretation of R-squared is not changed

Unconditional error variance is unaffected by heteroskedasticity (which refers to the conditional error variance)

`\(R^{2} \approx 1-\frac{\sigma_{u}^{2}}{\sigma_{y}^{2}}\)`

???
add example with wage and educ
Because the OLS standard errors are based directly on these variances, they are no longer valid for constructing confidence intervals and t statistics


---
## 8.2 Heteroskedasticity-robust inference after OLS estimation

  - Formulas for OLS standard errors and related statistics have been developed that are robust to heteroskedasticity of unknown form.
  - All formulas are only valid in large samples.
  - Formula for heteroskedasticity-robust OLS standard error.

White/ Hubber/ Eicker standard errors: they involve the squared residuals from the regression and from a regression of `\(x_j\)` on all other explanatory variables

`$$\widehat{\operatorname{Var}}\left(\widehat{\beta}_{j}\right)=\frac{\sum_{i=1}^{n} \widehat{r}_{i j}^{2} \widehat{u}_{i}^{2}}{S S R_{j}^{2}}$$`

  - Using these formulas, the usual `t test` is valid asymptotically.
  - The usual `F statistic` does not work under heteroskedasticity, but heteroskedasticity robust versions are available in most software.



---
### a) heteroskedasticity-robust LM statistic


???
Evaluate the following statement: The heteroskedasticity-robust standard errors are always bigger than the usual standard errors

The statement is false. For example, in equation (8.7), the usual standard error for black is .147, while the heteroskedasticity-robust standard error is .118.






---
## 8.3 Testing for Heteroskedasticity

**Breusch-Pagan test for heteroskedasticity**

`\(H_{0}: \operatorname{Var}\left(u \mid x_{1}, x_{2}, \ldots, x_{k}\right)=\operatorname{Var}(u \mid \mathbf{x})=\sigma^{2}\)`

`\(\operatorname{Var}(u \mid \mathbf{x})=E\left(u^{2} \mid \mathbf{x}\right)-[E(u \mid \mathbf{x})]^{2}=E\left(u^{2} \mid \mathbf{x}\right)\)`

`\(\Rightarrow E\left(u^{2} \mid x_{1}, \ldots, x_{k}\right)=E\left(u^{2}\right)=\sigma^{2}\)`

Regress squared residuals on all explanatory variables and test whether this regression has explanatory power

`\(\widehat{u}^{2}=\delta_{0}+\delta_{1} x_{1}+\cdots+\delta_{k} x_{k}+\)` error

`\(H_{0}: \delta_{1}=\delta_{2}=\cdots=\delta_{k}=0\)`

A large test statistic (= a high R-squared) is evidence against the null hypothesis

`\(F=\frac{R_{\widehat{u}^{2} / k}^{2}}{1-R_{\widehat{u}^{2}}^{2} /(n-k-1)}\)`


Alternative test statistic (= Lagrange multiplier statistic, LM). Again, high values of the test statistic (=high R-squared) lead to rejection of the null hypothesis that the expected value of `\(u^2\)` is unrelated to the explanatory variables.


`\(L M=n \cdot R_{\widehat{u}^{2}}^{2} \sim \chi_{k}^{2}\)`



???
It may still be interesting whether there is heteroskedasticity because then OLS may not be the most efficient linear estimator anymore.

---
### Example: Heteroskedasticity in housing price equations

&lt;img src="81.png" width="500px" style="display: block; margin: auto;" /&gt;


---


|            | Model 1  |
|:-----------|:--------:|
|(Intercept) | -21.770  |
|            | (29.475) |
|lotsize     |  0.002   |
|            | (0.001)  |
|sqrft       |  0.123   |
|            | (0.013)  |
|bdrms       |  13.853  |
|            | (9.010)  |
|Num.Obs.    |    88    |
|R2          |  0.672   |
|R2 Adj.     |  0.661   |
|AIC         |  975.8   |
|BIC         |  988.1   |
|Log.Lik.    | -482.877 |
|F           |  57.460  |
|RMSE        |  59.83   |
---

![](chapter_8_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

---

![](chapter_8_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;

---


```
## 
## Call:
## lm(formula = lprice ~ llotsize + lsqrft + bdrms, data = hprice1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.68422 -0.09178 -0.01584  0.11213  0.66899 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1.29704    0.65128  -1.992   0.0497 *  
## llotsize     0.16797    0.03828   4.388 3.31e-05 ***
## lsqrft       0.70023    0.09287   7.540 5.01e-11 ***
## bdrms        0.03696    0.02753   1.342   0.1831    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.1846 on 84 degrees of freedom
## Multiple R-squared:  0.643,	Adjusted R-squared:  0.6302 
## F-statistic: 50.42 on 3 and 84 DF,  p-value: &lt; 2.2e-16
```

---

![](chapter_8_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;

---

![](chapter_8_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;


---


```
## [1] 3
```

```
## [1] 0.1601407
```

```
## [1] 88
```

```
## [1] 5.338919
```

```
## [1] 0.002047744
```

```
## [1] 14.09239
```

```
## [1] 0.00278206
```


---
### a) The White Test for Heteroskedasticity

Regress squared residuals on all explanatory variables, their squares, and all interaction terms

`\(\begin{aligned} \widehat{u}^{2}=&amp; \delta_{0}+\delta_{1} x_{1}+\delta_{2} x_{2}+\delta_{3} x_{3}+\delta_{4} x_{1}^{2}+\delta_{5} x_{2}^{2}+\delta_{6} x_{3}^{2} \\ &amp;+\delta_{7} x_{1} x_{2}+\delta_{8} x_{1} x_{3}+\delta_{9} x_{2} x_{3}+\text { error } \end{aligned}\)`


The White test detects more general deviations from heteroskedasticity than the Breusch- Pagan test

`\(H_{0}: \delta_{1}=\delta_{2}=\cdots=\delta_{9}=0\)`
`\(L M=n \cdot R_{\widehat{u}^{2}}^{2} \sim \chi_{9}^{2}\)`


Dissadvantage
  
  - Including all squares and interactions leads to a large number of estimated parameters (e.g. k=6 leads to 27 parameters to be estimated).



---
### Alternative form of the White test


`\(\widehat{u}^{2}=\delta_{0}+\delta_{1} \widehat{y}+\delta_{2} \widehat{y}^{2}+\)` error

This regression indirectly tests the dependence of the squared residuals on the explanatory variables, their squares, and interactions, because the predicted values of `\(y\)` and its square implicitly contrain all of these terms


&lt;img src="82.png" width="500px" style="display: block; margin: auto;" /&gt;



---
## 8.4 Weighted Least Squares Estimation

Before the development of heteroskedasticity-robust statistics, the response to a finding of heteroskedasticity was to specify its form and use a weighted least squares method, which we develop in this section


If we have correctly specified the form of the variance (as a function of explanatory variables), then weighted least squares (WLS) is more efficient than OLS, and WLS leads to new t and F statistics that have t and F distributions. 


We will also discuss the implications of using the wrong form of the variance in the WLS procedure.



---
### a) The Heteroskedasticity Is Known Up to a Multiplicative Constant


`\(\operatorname{Var}\left(u_{i} \mid \mathbf{x}_{i}\right)=\sigma^{2} h\left(\mathbf{x}_{i}\right), h\left(\mathbf{x}_{i}\right)=h_{i}&gt;0\)`

The functional form of the heteroskedasticity is known:
`\(h\left(\mathbf{x}_{i}\right)=h_{i}&gt;0\)`


`\(y_{i}=\beta_{0}+\beta_{1} x_{i 1}+\cdots+\beta_{k} x_{i k}+u_{i}\)`


`\(\left[\frac{y_{i}}{\sqrt{h_{i}}}\right]=\beta_{0}\left[\frac{1}{\sqrt{h_{i}}}\right]+\beta_{1}\left[\frac{x_{i 1}}{\sqrt{h_{i}}}\right]+\cdots+\beta_{k}\left[\frac{x_{i k}}{\sqrt{h_{i}}}\right]+\left[\frac{u_{i}}{\sqrt{h_{i}}}\right]\)`


Transformed model
`\(y_{i}^{*}=\beta_{0} x_{i 0}^{*}+\beta_{1} x_{i 1}^{*}+\cdots+\beta_{k} x_{i k}^{*}+u_{i}^{*}\)`


---
### Example: Savings and income

`\(\operatorname{sav}_{i}=\beta_{0}+\beta_{1} i n c_{i}+u_{i}, \operatorname{Var}\left(u_{i} \mid i n c_{i}\right)=\sigma^{2} i n c_{i}\)`

Note that this regression model has no intercept

`\(\left[\frac{s a v_{i}}{\sqrt{i n c_{i}}}\right]=\beta_{0}\left[\frac{1}{\sqrt{i n c_{i}}}\right]+\beta_{1}\left[\frac{i n c_{i}}{\sqrt{i n c_{i}}}\right]+u_{i}^{*}\)`

The transformed model is homoskedastic

`\(E\left(u_{i}^{* 2} \mid \mathbf{x}_{i}\right)=E\left[\left(\frac{u_{i}}{\sqrt{h_{i}}}\right)^{2} \mid \mathbf{x}_{i}\right]=\frac{E\left(u_{i}^{2} \mid \mathbf{x}\right)}{h_{i}}=\frac{\sigma^{2} h_{i}}{h_{i}}=\sigma^{2}\)`


If the other Gauss-Markov assumptions hold as well, OLS applied to the transformed model is the best linear unbiased estimator.

---
OLS in the transformed model is weighted least squares (WLS)


`\(\min \sum_{i=1}^{n}\left(\left[\frac{y_{i}}{\sqrt{h_{i}}}\right]-b_{0}\left[\frac{1}{\sqrt{h_{i}}}\right]-b_{1}\left[\frac{x_{i 1}}{\sqrt{h_{i}}}\right]-\cdots-b_{k}\left[\frac{x_{i k}}{\sqrt{h_{i}}}\right]\right)^{2}\)`



`\(\min \sum_{i=1}^{n}\left(y_{i}-b_{0}-b_{1} x_{i 1}-\cdots-b_{k} x_{i k}\right)^{2} / h_{i}\)`

Observations with a large variance get a smaller weight in the optimization problem


Why is WLS more efficient than OLS in the original model?

  - Observations with a large variance are less informative than observations with small variance and therefore should get less weight.

WLS is a special case of generalized least squares (GLS)



---
### Example: Financial wealth equation

&lt;img src="83.png" width="500px" style="display: block; margin: auto;" /&gt;


---

### Important special case of heteroskedasticity

If the observations are reported as averages at the city/county/state/-country/firm level, they should be weighted by the size of the unit

&lt;img src="84.png" width="500px" style="display: block; margin: auto;" /&gt;

If errors are homoskedastic at the individual-level, WLS with weights equal to firm size mi should be used. If the assumption of homoskedasticity at the individual-level is not exactly right, one can calculate robust standard errors after WLS (i.e. for the transformed model).


---

### b) The heteroskedasticity function must be estimated: Feasible GLS


Unknown heteroskedasticity function (feasible GLS)

Assumed general form of heteroskedasticity; exponential function is used to ensure positivity

`\(\operatorname{Var}(u \mid \mathrm{x})=\sigma^{2} \exp \left(\delta_{0}+\delta_{1} x_{1}+\cdots+\delta_{k} x_{k}\right)=\sigma^{2} h(\mathrm{x})\)`

Multiplicative error (assumption: independent of the explanatory variables)

`\(u^{2}=\sigma^{2} \exp \left(\delta_{0}+\delta_{1} x_{1}+\cdots+\delta_{k} x_{k}\right) \cdot v\)`
`\(\Rightarrow \log \left(u^{2}\right)=\alpha_{0}+\delta_{1} x_{1}+\cdots+\delta_{k} x_{k}+e\)`


Use inverse values of the estimated heteroskedasticity function as weights in WLS

`\(\log \left(\widehat{u}^{2}\right)=\widehat{\alpha}_{0}+\widehat{\delta}_{1} x_{1}+\cdots+\widehat{\delta}_{k} x_{k}+\)` error
`\(\Rightarrow \widehat{h}_{i}=\exp \left(\widehat{\alpha}_{0}+\widehat{\delta}_{1} x_{1}+\cdots+\widehat{\delta}_{k} x_{k}\right)\)`


---
### Steps to compute a Feasible GLS

1. Run the regression of `\(y\)` on `\(x_{1}, x_{2}, \ldots, x_{k}\)` and obtain the residuals, 0.

2. Create `\(\log \left(\mathrm{a}^{2}\right)\)` by first squaring the OLS residuals and then taking the natural log.

3. Run the regression in equation (8.32) and obtain the fitted values, `\(\hat{g}\)`.

4. Exponentiate the fitted values from `\((8.32): \widehat{h}=\exp (\hat{\mathrm{g}})\)`.

5. Estimate the equation
`$$y=\beta_{0}+\beta_{1} x_{1}+\cdots+\beta_{k} x_{k}+u$$`

by WLS, using weights `\(1 / \widehat{\mathrm{h}}\)`. In other words, we replace `\(\mathrm{h}_{\mathrm{i}}\)` with `\(\hat{\mathrm{h}}_{\mathrm{i}}\)` in equation (8.27). Remember, the squared residual for observation `\(i\)` gets weighted by `\(\overline{1} / \widehat{\mathrm{h}}_{\mathrm{i}}\)`, If instead we first transform all variables and run OLS, each variable gets multiplied by `\(1 / \sqrt{\hat{h}_{\mathrm{i}}}\)`, including the intercept.



---
### Example: Demand for cigarettes

Estimation by OLS

&lt;img src="85.png" width="500px" style="display: block; margin: auto;" /&gt;


&lt;img src="86.png" width="500px" style="display: block; margin: auto;" /&gt;



---
### Example: Demand for cigarettes

Estimation by FGLS


&lt;img src="87.png" width="500px" style="display: block; margin: auto;" /&gt;


Discussion:
  - The income elasticity is now statistically significant; other coefficients are also more precisely estimated (without changing qualitative results).


---

### c) What if the assumed heteroskedasticity function is wrong?


  - If the heteroskedasticity function is misspecified, WLS is still consistent under MLR.1 â€“ MLR.4, but robust standard errors should be computed.

  - If OLS and WLS produce very different estimates, this typically indicates that some other assumptions (e.g. MLR.4) are wrong.

  - If there is strong heteroskedasticity, it is still often better to use a wrong form of heteroskedasticity in order to increase efficiency.










































    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
